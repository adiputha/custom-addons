<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Tree view for Petty Cash Bill Settlement -->
    <record id="petty_cash_bill_settlement_tree_view" model="ir.ui.view">
        <field name="name">petty.cash.bill.settlement.list</field>
        <field name="model">petty.cash.bill.settlement</field>
        <field name="arch" type="xml">
            <list editable="bottom"
                decoration-success="status == 'approved'"
                decoration-warning="status == 'submitted'"
                decoration-danger="status == 'rejected'"
                decoration-info="status == 'draft'">
                <field name="date" />
                <field name="category" />
                <field name="amount" sum="Total Amount" widget="monetary" />
                <field name="attach_receipt" filename="receipt_filename" />
                <field name="receipt_filename" invisible="1" />
                <field name="action" widget="selection"
                    readonly="parent.state not in ['cash_issued', 'requested']" />
                <field name="status" readonly="1" widget="badge" />
                <field name="description"
                    readonly="parent.state not in ['cash_issued', 'requested']" />
            </list>
        </field>
    </record>

    <!-- Form view for Petty Cash Bill Settlement -->
    <record id="petty_cash_bill_settlement_form_view" model="ir.ui.view">
        <field name="name">petty.cash.bill.settlement.form</field>
        <field name="model">petty.cash.bill.settlement</field>
        <field name="arch" type="xml">
            <form string="Bill Settlement">
                <header>
                    <button name="action_submit" string="Submit for Approval"
                        type="object" class="btn-primary"
                        invisible="status != 'draft'" />
                    <button name="action_approve" string="Approve"
                        type="object" class="btn-success"
                        invisible="status != 'submitted'"
                        groups="account.group_account_user" />
                    <button name="action_reject" string="Reject"
                        type="object" class="btn-danger"
                        invisible="status != 'submitted'"
                        groups="account.group_account_user" />
                    <field name="status" widget="statusbar"
                        statusbar_visible="draft,submitted,approved" />
                </header>

                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="category" readonly="status != 'draft'" />
                        </h1>
                    </div>

                    <group>
                        <group>
                            <field name="petty_cash_request_id" readonly="1" />
                            <field name="date" readonly="status not in ['draft', 'submitted']" />
                            <field name="amount" widget="monetary" readonly="status != 'draft'" />
                        </group>
                        <group>
                            <field name="approved_by"
                                invisible="status not in ['approved', 'rejected']" />
                            <field name="approval_date"
                                invisible="status not in ['approved', 'rejected']" />
                        </group>
                    </group>

                    <group string="Receipt">
                        <field name="attach_receipt" filename="receipt_filename"
                            readonly="status not in ['draft', 'submitted']" />
                        <field name="receipt_filename" invisible="1" />
                    </group>

                    <group string="description">
                        <field name="description" nolabel="1"
                            placeholder="Enter any additional notes or rejection reason..."
                            readonly="status == 'approved'" />
                    </group>

                    <group string="Rejection Details" invisible="status != 'rejected'">
                        <field name="rejection_reason" readonly="1" />
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Search view for Petty Cash Bill Settlement -->
    <record id="petty_cash_bill_settlement_search_view" model="ir.ui.view">
        <field name="name">petty.cash.bill.settlement.search</field>
        <field name="model">petty.cash.bill.settlement</field>
        <field name="arch" type="xml">
            <search string="Search Bill Settlements">
                <field name="petty_cash_request_id" />
                <field name="category" />
                <field name="amount" />
                <separator />
                <filter name="draft" string="Draft" domain="[('status', '=', 'draft')]" />
                <filter name="submitted" string="Submitted" domain="[('status', '=', 'submitted')]" />
                <filter name="approved" string="Approved" domain="[('status', '=', 'approved')]" />
                <filter name="rejected" string="Rejected" domain="[('status', '=', 'rejected')]" />
                <separator />
                <filter name="pending_approval" string="Pending Approval"
                    domain="[('status', '=', 'submitted')]" />
                <filter name="my_approvals" string="My Approvals"
                    domain="[('approved_by', '=', uid)]" />
                <separator />
                <group expand="0" string="Group By">
                    <filter name="group_by_status" string="Status"
                        context="{'group_by': 'status'}" />
                    <filter name="group_by_category" string="Category"
                        context="{'group_by': 'category'}" />
                    <filter name="group_by_request" string="Petty Cash Request"
                        context="{'group_by': 'petty_cash_request_id'}" />
                    <filter name="group_by_date" string="Date"
                        context="{'group_by': 'date'}" />
                </group>
            </search>
        </field>
    </record>

    <!-- Action for Petty Cash Bill Settlement -->
    <record id="action_petty_cash_bill_settlements" model="ir.actions.act_window">
        <field name="name">Bill Settlements</field>
        <field name="res_model">petty.cash.bill.settlement</field>
        <field name="view_mode">list,form</field>
        <field name="search_view_id" ref="petty_cash_bill_settlement_search_view" />
        <field name="context">{
            'search_default_pending_approval': 1,
            'default_status': 'draft'
            }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No bill settlements found!
            </p>
            <p>
                Bill settlements are automatically created when petty cash requests
                include expense details. They track individual expenses and receipts
                for proper accounting and approval.
            </p>
        </field>
    </record>
</odoo>